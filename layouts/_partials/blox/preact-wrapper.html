{{/* Hugo Blox: Generic Preact Block Wrapper */}}
{{/* Overrides the theme default to pre-render the hero H1 in static HTML for SEO */}}

{{/* Initialize variables */}}
{{ $page := .wcPage }}
{{ $block := .wcBlock }}
{{ $block_type := .wcBlockType }}
{{ $block_id := .wcIdentifier | default (printf "%s-%d" $block_type (now.Unix)) }}

{{/* Prepare props for the Preact component */}}
{{ $props := dict
  "content" $block.content
  "design" $block.design
  "id" $block_id
  "type" $block_type
}}

{{/* If an icon is specified, fetch its SVG data and add it to the props */}}
{{ with $block.content.primary_action.icon }}
  {{ $icon_data := partial "functions/get_icon_data" (dict "name" .) }}
  {{ if $icon_data }}
    {{ $props = merge $props (dict "icon_svg" $icon_data) }}
  {{ end }}
{{ end }}

{{/* Convert props to JSON for client-side rendering */}}
{{ $propsJSON := $props | jsonify }}

{{/* Render a container that Preact will populate */}}
<div
  id="{{ $block_id }}"
  class="{{ $block_type }}-block-container preact-block"
  data-block-type="{{ $block_type }}"
  data-props='{{ $propsJSON | safeHTML }}'
  data-preact-render="true"
>
  {{/* For hero blocks: pre-render the H1 in static HTML so crawlers find it.
       Preact replaces this container's innerHTML on hydration, swapping this
       visually-hidden element for its own styled H1. At no point are there
       two H1 tags in the DOM. */}}
  {{ if and (eq $block_type "hero") $block.content.title }}
    <h1 class="sr-only">{{ $block.content.title }}</h1>
  {{ end }}
</div>

{{/* Preact script loading is handled by libraries.html */}}
