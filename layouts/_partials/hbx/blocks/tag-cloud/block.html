{{/* Hugo Blox: Tag Cloud Block */}}
{{/* Custom block for albertlg.com */}}

{{/* Initialise */}}
{{ $page := .wcPage }}
{{ $block := .wcBlock }}

{{ $title := $block.content.title | default "Popular Topics" | emojify | $page.RenderString }}
{{ $subtitle := $block.content.subtitle | emojify | $page.RenderString }}

<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12 sm:py-16">

  {{/* Section Header */}}
  <div class="text-center mb-10">
    {{ with $title }}
    <h2 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-gray-900 dark:text-white tracking-tight mb-4">
      {{ . }}
    </h2>
    {{ end }}

    {{ with $subtitle }}
    <p class="text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
      {{ . }}
    </p>
    {{ end }}
  </div>

  {{/* Tag Cloud â€” limited to top 20 tags by post count */}}
  {{ $tags := $page.Site.Taxonomies.tags }}
  {{ if $tags }}

  {{/* Sort tags by page count (descending) and take top 20 */}}
  {{ $tagSlice := slice }}
  {{ range $name, $taxonomy := $tags }}
    {{ $tagSlice = $tagSlice | append (dict "name" $name "count" (len $taxonomy.Pages) "taxonomy" $taxonomy) }}
  {{ end }}
  {{ $tagSlice = sort $tagSlice "count" "desc" }}
  {{ $limit := $block.content.count | default 20 }}
  {{ $tagSlice = first $limit $tagSlice }}

  {{/* Compute max count for step-based scaling (from the filtered set) */}}
  {{ $maxCount := 1 }}
  {{ range $tagSlice }}
    {{ if gt .count $maxCount }}
      {{ $maxCount = .count }}
    {{ end }}
  {{ end }}

  <div class="flex flex-wrap justify-center gap-3">
    {{ range $tagSlice }}
      {{ $count := .count }}
      {{/* Step-based sizing: 5 tiers from text-sm to text-2xl */}}
      {{ $tier := mul (div (mul $count 4) $maxCount) 1 }}
      {{ $sizeClass := "text-sm" }}
      {{ if ge $tier 4 }}
        {{ $sizeClass = "text-2xl font-bold" }}
      {{ else if ge $tier 3 }}
        {{ $sizeClass = "text-xl font-semibold" }}
      {{ else if ge $tier 2 }}
        {{ $sizeClass = "text-lg font-medium" }}
      {{ else if ge $tier 1 }}
        {{ $sizeClass = "text-base" }}
      {{ end }}
      {{ $url := printf "tags/%s/" (.name | urlize) }}
      <a href="{{ $url | relLangURL }}"
         class="inline-block px-3 py-1 rounded-full bg-primary-50 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 hover:bg-primary-100 dark:hover:bg-primary-900/50 transition-colors {{ $sizeClass }}"
         title="{{ $count }} {{ i18n "posts" | default "posts" }}">
        {{ .name }}
      </a>
    {{ end }}
  </div>
  {{ end }}

</div>
